<aside
  class="relative h-full overflow-hidden flex flex-col shrink-0 ai-chat-panel-enter bg-gradient-to-b from-card to-card via-muted/20 shadow-[-4px_0_16px_rgba(0,0,0,0.1)]"
  [style.width.px]="previewWidth || panelWidth"
  [style.opacity]="previewWidth !== null ? '0.8' : '1'"
  style="transform-origin: right center; transition: width 0.3s var(--ease-spring-smooth);">
  <!-- Resize Handle -->
  <ai-resize-handle
    [minWidth]="300"
    [maxWidth]="800"
    (resizePreview)="onResizePreview($event)"
    (resizeCommit)="onResizeCommit($event)" />

  <!-- Panel Header -->
  <ai-panel-header
    [sessionName]="sessionName"
    [hasNewMessages]="false"
    (rename)="onRename($event)"
    (delete)="onDelete()"
    (close)="close.emit()" />

  <!-- Messages Container -->
  <div class="ai-messages flex-1 overflow-y-auto" style="max-height: calc(100vh - 120px);">
    <div class="p-4 space-y-4">
      @for (message of messages(); track message.id) {
        @if (message.role === 'user') {
          <ai-message-bubble [message]="message" />
        } @else {
          <!-- AI messages use solid color background -->
          <div class="flex justify-start animate-[message-bubble-in_0.2s_var(--ease-spring-snappy)]">
            <div class="max-w-[80%] rounded-lg rounded-tl-sm bg-muted/50 border border-border/50 px-4 py-2">
              <app-streaming-markdown
                [stream$]="of(message.content)"
                [maxHeight]="'none'"
                [virtualScroll]="false" />
            </div>
          </div>
        }
      }

      @if (streamingContent) {
        <div class="flex justify-start">
          <div class="max-w-[80%] rounded-lg rounded-tl-sm bg-muted/50 border border-border/50 px-4 py-2">
            <app-streaming-markdown
              [stream$]="of(streamingContent)"
              [maxHeight]="'none'"
              [virtualScroll]="false" />
          </div>
        </div>
      }

      @if (messages().length === 0 && !streamingContent) {
        <div class="empty-state flex items-center justify-center h-64 text-muted-foreground">
          <p class="text-sm">开始一个新的对话...</p>
        </div>
      }
    </div>
  </div>
</aside>
