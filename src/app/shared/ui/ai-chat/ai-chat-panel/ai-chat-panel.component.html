<aside
  class="fixed top-0 bottom-0 right-3 z-30 flex flex-col rounded-3xl bg-card shadow-2xl border border-border/50 ai-chat-panel-enter"
  [style.width.px]="previewWidth || panelWidth"
  [style.opacity]="previewWidth !== null ? '0.8' : '1'"
  style="transform-origin: right center; transition: width 0.3s var(--ease-spring-smooth), opacity 0.2s ease; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);">
  <!-- Resize Handle -->
  <ai-resize-handle
    [minWidth]="300"
    [maxWidth]="800"
    (resizePreview)="onResizePreview($event)"
    (resizeCommit)="onResizeCommit($event)" />

  <!-- Panel Header -->
  <ai-panel-header
    [sessionName]="sessionName"
    [hasNewMessages]="false"
    (rename)="onRename($event)"
    (delete)="onDelete()"
    (close)="close.emit()" />

  <!-- Messages Container -->
  <div class="ai-messages flex-1 overflow-y-auto">
    <div class="p-3 space-y-3">
      @for (message of messages(); track message.id) {
        <ai-message-bubble [message]="message" />
      }

      @if (getStreamingStream(); as stream) {
        <div class="flex justify-start">
          <div class="w-full rounded-lg rounded-tl-sm bg-muted/50 border border-border/50 px-3 py-1.5">
            <app-streaming-markdown
              [stream$]="stream"
              [maxHeight]="'none'"
              [virtualScroll]="false" />
          </div>
        </div>
      }

      @if (messages().length === 0 && !streamingContent) {
        <div class="empty-state flex items-center justify-center h-64 text-muted-foreground">
          <p class="text-sm">开始一个新的对话...</p>
        </div>
      }
    </div>
  </div>
</aside>
