<div class="app-shell flex min-h-screen bg-background relative">
  <!-- Main Content Area (compressible when panel opens) -->
  <main
    #mainContent
    class="main-content flex-1 transition-all duration-300 ease-out"
    [style.padding-right.px]="panelOpen() ? effectivePanelWidth() + 12 : 0">
    <router-outlet />
  </main>

  <!-- AI Chat Panel (fixed floating panel) -->
  @if (panelOpen()) {
    <ai-chat-panel
      [activeSession]="activeSession"
      [panelWidth]="panelWidth()"
      [previewWidth]="panelPreviewWidth()"
      [streamingContent]="streamingResponse()"
      (rename)="onRename($event)"
      (delete)="onDelete($event)"
      (close)="onClosePanel()"
      (resizePreview)="onResizePreview($event)"
      (resizeCommit)="onResizeCommit($event)" />
  }

  <!-- Session Chat Container (fixed, always floating at bottom) -->
  <!-- Width is 40% of main content area, positioned accordingly -->
  <div
    class="fixed z-40 flex justify-center"
    [class]="panelOpen() ? 'bottom-3' : 'bottom-6'"
    [style.width.px]="sessionContainerWidthPx()"
    [style.left.px]="sessionContainerLeftPx()"
    [style.transform]="'translateX(-50%)'">
    <app-session-chat-container
      [sessions]="sessions"
      [activeSessionId]="activeSessionId"
      [inputValue]="currentInputValue"
      (newChat)="onNewChat()"
      (sessionSelect)="onSessionSelect($event)"
      (sessionToggle)="onSessionToggle()"
      (send)="onSend($event)"
      (inputValueChange)="onInputChange($event)"
      (sessionColorChange)="onSessionColorChange($event)"
      (sessionRename)="onSessionRenameFromTabs($event)"
      (sessionClose)="onDelete($event)" />
  </div>

  <!-- Delete Confirmation Dialog -->
  <ai-delete-confirm-dialog
    [isOpen]="deleteDialogOpen()"
    [sessionName]="sessionToDeleteName()"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()" />
</div>
