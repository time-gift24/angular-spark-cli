<div class="session-tabs-container">
  <button
    type="button"
    class="inline-flex h-6 shrink-0 cursor-pointer select-none items-center gap-0.5 rounded-full border border-primary/25 bg-primary/8 px-1.5 text-[10px] font-medium leading-none text-primary transition-colors duration-200 hover:bg-primary/14 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/45 focus-visible:ring-offset-1"
    (click)="handleNewChat($event)"
    [attr.aria-label]="'New Chat'"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="h-2.5 w-2.5"
      aria-hidden="true"
    >
      <line x1="12" y1="5" x2="12" y2="19" />
      <line x1="5" y1="12" x2="19" y2="12" />
    </svg>
    <span class="hidden max-w-[7.5rem] truncate sm:inline">新建</span>
  </button>

  @for (session of displaySessions(); track session.id) {
    @let isActive = session.id === activeSessionId()();
    <button
      type="button"
      [uiContextMenuTrigger]="getSessionMenuItems(session.id)"
      [title]="session.name"
      (click)="handleSessionClick($event, session.id)"
      [attr.aria-label]="'Switch to ' + session.name"
      [attr.aria-selected]="isActive"
      class="session-tab"
      [class.active]="isActive"
      [class.status-processing]="session.status === 'processing'"
      [class.status-disconnected]="session.status === 'disconnected'"
      [style.background]="getSessionBackgroundColor(session, isActive)"
      [style.borderColor]="getSessionBorderColor(session, isActive)"
      [style.color]="getSessionTextColor(session, isActive)"
    >
      @if (session.status === 'processing') {
        <svg
          class="status-icon processing-icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path
            d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"
          />
        </svg>
      } @else if (session.status === 'disconnected') {
        <svg
          class="status-icon disconnected-icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path
            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
          />
          <line x1="12" y1="9" x2="12" y2="13" />
          <line x1="12" y1="17" x2="12.01" y2="17" />
        </svg>
      } @else {
        <svg
          class="status-icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.9"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path d="m3 8 9 5 9-5" />
          <path d="m3 16 9 5 9-5" />
          <path d="M12 13v8" />
          <path d="M12 3 3 8l9 5 9-5-9-5Z" />
        </svg>
      }
      <span class="max-w-[6.5rem] truncate">{{ session.name }}</span>
    </button>
  }
</div>
