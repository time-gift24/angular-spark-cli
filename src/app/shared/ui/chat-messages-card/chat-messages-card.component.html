<div
  liquidGlass
  lgTheme="mineral-light"
  lgCornerRadius="16px"
  [lgBlurAmount]="0.5"
  [lgDisplacementScale]="0"
  lgTint="oklch(0 0 0 / 2%)"
  lgHotspot="oklch(1 0 0 / 3%)"
  lgAriaLabel="AI chat messages card"
  [class.visible]="safeIsVisible"
  [style.left.px]="safePosition.x"
  [style.top.px]="safePosition.y"
  [style.width.px]="safeSize.width"
  [style.height.px]="safeSize.height"
  class="messages-card"
>
  <!-- 拖拽手柄 -->
  <div
    class="drag-handle"
    [appDragHandle]="position"
    [dragHandleSize]="size"
    (positionChange)="positionChange.emit($event)"
    title="拖拽移动面板"
  >
    <svg class="drag-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="9" cy="5" r="1"/>
      <circle cx="9" cy="12" r="1"/>
      <circle cx="9" cy="19" r="1"/>
      <circle cx="15" cy="5" r="1"/>
      <circle cx="15" cy="12" r="1"/>
      <circle cx="15" cy="19" r="1"/>
    </svg>
  </div>

  <!-- 消息列表 -->
  <div #messageList class="message-list">
    @for (message of safeMessages; track message.id) {
      <div [class.role-user]="message.role === 'user'"
           [class.role-assistant]="message.role === 'assistant'"
           [class.role-system]="message.role === 'system'"
           class="message">
        <div class="message-content">{{ message.content }}</div>
        <div class="message-timestamp">{{ message.timestamp | date: 'short' }}</div>
      </div>
    } @empty {
      <div class="empty-state">
        <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <span>开始与 AI 对话...</span>
      </div>
    }
  </div>

  <!-- 右上角缩放手柄 -->
  <div
    class="resize-handle resize-handle-top-right"
    [appResizeHandle]="size"
    [resizeMode]="'top-right'"
    [position]="position"
    (sizeChange)="sizeChange.emit($event)"
    (positionChange)="positionChange.emit($event)"
    title="拖拽调整大小（固定底部）"
  >
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <!-- 向左箭头 -->
      <path d="M14 3l-4 4m0 0l4 4m-4-4h10"/>
      <!-- 向上箭头 -->
      <path d="M3 14l4-4m0 0l4 4m-4-4v10"/>
    </svg>
  </div>

  <!-- 右下角缩放手柄 -->
  <div
    class="resize-handle resize-handle-bottom-right"
    [appResizeHandle]="size"
    (sizeChange)="sizeChange.emit($event)"
    title="拖拽调整大小"
  >
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <!-- 向右箭头 -->
      <path d="M10 21l4-4m0 0l-4-4m4 4H4"/>
      <!-- 向下箭头 -->
      <path d="M21 10l-4 4m0 0l-4-4m4 4V4"/>
    </svg>
  </div>
</div>
