@if (enableLiquidGlass) {
  <!-- 带 Liquid Glass 效果的容器 -->
  <div
    liquidGlass
    lgTheme="mineral-light"
    lgCornerRadius="16px"
    [lgBlurAmount]="0.5"
    [lgDisplacementScale]="0"
    [lgDisableAnimation]="liquidGlassDisabled()"
    lgTint="oklch(0 0 0 / 2%)"
    lgHotspot="oklch(1 0 0 / 3%)"
    lgAriaLabel="AI chat messages card"
    [class.visible]="safeIsVisible()"
    [style.left.px]="safePosition().x"
    [style.top.px]="safePosition().y"
    [style.width.px]="safeSize().width"
    [style.height.px]="safeSize().height"
    class="messages-card"
  >
    <ng-container ngTemplateOutlet="cardContent" />
  </div>
} @else {
  <!-- 基础容器（无 liquid glass 效果，性能更好） -->
  <div
    [class.visible]="safeIsVisible()"
    [style.left.px]="safePosition().x"
    [style.top.px]="safePosition().y"
    [style.width.px]="safeSize().width"
    [style.height.px]="safeSize().height"
    class="messages-card messages-card-plain"
  >
    <ng-container ngTemplateOutlet="cardContent" />
  </div>
}

<!-- 卡片内容模板 -->
<ng-template #cardContent>
  <!-- 拖拽手柄 -->
  <div
    class="drag-handle"
    [appDragHandle]="position"
    [dragHandleSize]="size"
    (positionChange)="positionChange.emit($event)"
    (dragStart)="onDragStart()"
    (dragEnd)="onDragEnd()"
    title="拖拽移动面板"
  >
    <svg class="drag-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="9" cy="5" r="1"/>
      <circle cx="9" cy="12" r="1"/>
      <circle cx="9" cy="19" r="1"/>
      <circle cx="15" cy="5" r="1"/>
      <circle cx="15" cy="12" r="1"/>
      <circle cx="15" cy="19" r="1"/>
    </svg>
  </div>

  <!-- 消息列表 -->
  <div #messageList class="message-list">
    @for (message of safeMessages(); track message.id) {
      <div [class.role-user]="message.role === 'user'"
           [class.role-assistant]="message.role === 'assistant'"
           [class.role-system]="message.role === 'system'"
           class="message">
        <div class="message-content">{{ message.content }}</div>
        <div class="message-timestamp">{{ message.timestamp | date: 'short' }}</div>
      </div>
    } @empty {
      <div class="empty-state">
        <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <span>开始与 AI 对话...</span>
      </div>
    }
  </div>

  <!-- 右上角缩放手柄 -->
  <div
    class="resize-handle resize-handle-top-right"
    [appResizeHandle]="size"
    [resizeMode]="'top-right'"
    [position]="position"
    (sizeChange)="sizeChange.emit($event)"
    (positionChange)="positionChange.emit($event)"
    (resizeStart)="onResizeStart()"
    (resizeEnd)="onResizeEnd()"
    title="拖拽调整大小（固定底部）"
  >
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="resize-icon">
      <path d="M15 5L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M15 9L7 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M15 13L3 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </div>

  <!-- 右下角缩放手柄 -->
  <div
    class="resize-handle resize-handle-bottom-right"
    [appResizeHandle]="size"
    (sizeChange)="sizeChange.emit($event)"
    (resizeStart)="onResizeStart()"
    (resizeEnd)="onResizeEnd()"
    title="拖拽调整大小"
  >
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="resize-icon">
      <path d="M11 15L15 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M7 15L15 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M3 15L15 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </div>
</ng-template>
