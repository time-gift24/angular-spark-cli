<div
  #card
  liquidGlass
  lgTheme="mineral-light"
  lgCornerRadius="12px"
  [lgBlurAmount]="0.5"
  [lgDisplacementScale]="0"
  lgTint="oklch(0 0 0 / 2%)"
  lgHotspot="oklch(1 0 0 / 3%)"
  lgAriaLabel="Enhanced chat messages card"
  [ngStyle]="cardStyle()"
  cdkDrag
  [cdkDragDisabled]="isResizing()"
  (cdkDragStarted)="onDragStart($event)"
  (cdkDragEnded)="onDragEnd($event)"
>

  <!-- Title Bar (Drag Handle + Controls) -->
  <div class="card-title-bar" cdkDragHandle>
    <div class="title-bar-left">
      <svg class="drag-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
      <span class="session-name">{{ cardState().maximized ? 'Maximized' : (cardState().minimized ? 'Minimized' : 'Chat') }}</span>
    </div>

    <div class="title-bar-controls">
      <!-- Minimize Button -->
      <button
        type="button"
        class="control-btn"
        (click)="toggleMinimize()"
        [disabled]="cardState().maximized"
        aria-label="Minimize"
        title="Minimize"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="4" y1="12" x2="20" y2="12"></line>
        </svg>
      </button>

      <!-- Maximize/Restore Button -->
      <button
        type="button"
        class="control-btn"
        (click)="toggleMaximize()"
        [disabled]="cardState().minimized"
        [attr.aria-label]="cardState().maximized ? 'Restore' : 'Maximize'"
        [title]="cardState().maximized ? 'Restore' : 'Maximize'"
      >
        @if (cardState().maximized) {
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="4" y="4" width="14" height="14" rx="2"></rect>
          </svg>
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2"></rect>
          </svg>
        }
      </button>
    </div>
  </div>

  <!-- Messages Container (hidden when minimized) -->
  @if (showContent()) {
    <div class="messages-container" #messagesContainer>
      @for (message of messages(); track message.id) {
        <div [class]="'message message-' + message.role">
          <div [class]="'message-bubble bubble-' + message.role">
            @if (message.role === 'assistant') {
              <div class="ai-content">
                <p>{{ message.content }}</p>
              </div>
            } @else {
              {{ message.content }}
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Resize Handles (8 handles) -->
  @if (!cardState().maximized && !cardState().minimized) {
    <!-- Top-Left -->
    <div class="resize-handle resize-nw" (mousedown)="startResize($event, 'nw')"></div>

    <!-- Top -->
    <div class="resize-handle resize-n" (mousedown)="startResize($event, 'n')"></div>

    <!-- Top-Right -->
    <div class="resize-handle resize-ne" (mousedown)="startResize($event, 'ne')"></div>

    <!-- Right -->
    <div class="resize-handle resize-e" (mousedown)="startResize($event, 'e')"></div>

    <!-- Bottom-Right -->
    <div class="resize-handle resize-se" (mousedown)="startResize($event, 'se')"></div>

    <!-- Bottom -->
    <div class="resize-handle resize-s" (mousedown)="startResize($event, 's')"></div>

    <!-- Bottom-Left -->
    <div class="resize-handle resize-sw" (mousedown)="startResize($event, 'sw')"></div>

    <!-- Left -->
    <div class="resize-handle resize-w" (mousedown)="startResize($event, 'w')"></div>
  }
</div>
